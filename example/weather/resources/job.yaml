id: weather # config.Batch.JobName と一致させる
name: Weather Data Processing Job
description: This job fetches weather data, processes it, and stores it.
listeners: # ★ 追加: ジョブレベルのリスナー定義
  - ref: loggingJobListener # JobFactory で登録されているリスナー名

flow:
  start-element: fetchWeatherDataStep # フローの開始要素
  elements:
    fetchWeatherDataStep:
      id: fetchWeatherDataStep
      reader:
        ref: weatherItemReader # 新しいコンポーネント名に更新
      processor:
        ref: weatherItemProcessor # 新しいコンポーネント名に更新
      writer:
        ref: weatherItemWriter # 新しいコンポーネント名に更新
      chunk:
        item-count: 50 # config.Batch.ChunkSize を利用
        commit-interval: 1 # ★ 追加: コミット間隔を設定
      listeners: # ステップレベルリスナー
        - ref: loggingStepListener
        - ref: retryStepListener
      item-read-listeners: # アイテム読み込みリスナーを有効化
        - ref: loggingItemReadListener
      item-process-listeners: # アイテム処理リスナーを有効化
        - ref: loggingItemProcessListener
      item-write-listeners: # アイテム書き込みリスナーを有効化
        - ref: loggingItemWriteListener
      skip-listeners: # アイテムスキップリスナー
        - ref: loggingSkipListener
      retry-item-listeners: # アイテムリトライリスナー
        - ref: loggingRetryItemListener
      transitions:
        - on: COMPLETED # ステップが正常完了した場合
          to: processDummyDataStep # 次のステップへ遷移
        - on: FAILED # ステップが失敗した場合
          fail: true # ジョブ全体を失敗として終了
    processDummyDataStep:
      id: processDummyDataStep
      reader:
        ref: dummyItemReader # 新しいコンポーネント名に更新
      processor:
        ref: dummyItemProcessor # 新しいコンポーネント名に更新
      writer:
        ref: dummyItemWriter # 新しいコンポーネント名に更新
      chunk:
        item-count: 10 # このステップのチャンクサイズ
        commit-interval: 1 # ★ 追加: コミット間隔を設定
      listeners: # ステップレベルリスナー
        - ref: loggingStepListener
        - ref: retryStepListener
      item-read-listeners: # アイテム読み込みリスナーを有効化
        - ref: loggingItemReadListener
      item-process-listeners: # アイテム処理リスナーを有効化
        - ref: loggingItemProcessListener
      item-write-listeners: # アイテム書き込みリスナーを有効化
        - ref: loggingItemWriteListener
      skip-listeners: # アイテムスキップリスナー
        - ref: loggingSkipListener
      retry-item-listeners: # アイテムリトライリスナー
        - ref: loggingRetryItemListener
      transitions:
        - on: COMPLETED
          to: dummyTaskletStep # 新しい Tasklet ステップへ遷移
        - on: FAILED
          fail: true # ジョブ全体を失敗として終了
    dummyTaskletStep: # 例として Tasklet ステップを追加
      id: dummyTaskletStep
      tasklet:
        ref: dummyTasklet # JobFactory で登録されているダミーコンポーネント名
      listeners: # ステップレベルリスナー (TaskletStep も StepExecutionListener を持つ)
        - ref: loggingStepListener
        - ref: retryStepListener
      transitions:
        - on: COMPLETED
          end: true
        - on: FAILED
          fail: true
